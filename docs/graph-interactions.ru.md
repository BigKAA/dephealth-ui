# Взаимодействие с графом

**Язык:** [English](./graph-interactions.md) | Русский

---

## Обзор

Граф топологии поддерживает взаимодействие мышью и клавиатурой для навигации, выделения и перестановки узлов. Все взаимодействия работают с обоими типами раскладки — **dagre** и **fcose**.

## Клавиши-модификаторы

| Модификатор | Windows / Linux | macOS |
|-------------|----------------|-------|
| Ctrl | `Ctrl` | `Cmd (⌘)` |
| Shift | `Shift` | `Shift` |

В этом документе «Ctrl» означает `Ctrl` в Windows/Linux и `Cmd (⌘)` в macOS.

## Матрица событий

| Действие | Цель | Ctrl | Shift | Результат |
|----------|------|------|-------|-----------|
| Клик | Узел | — | — | Открыть/закрыть боковую панель |
| Клик | Узел | + | — | Добавить/убрать выделение |
| Клик | Фон | — | — | Снять выделение, закрыть панель |
| Перетаскивание | Узел | — | — | Переместить один узел |
| Перетаскивание | Выделенный узел (группа) | — | — | Переместить всю группу |
| Перетаскивание | Узел | + | — | Переместить + 1 уровень downstream |
| Перетаскивание | Узел | + | + | Переместить + весь downstream-подграф |
| Перетаскивание | Фон | — | — | Панорамирование |
| Перетаскивание | Фон | + | — | Прямоугольное выделение |
| Двойной клик | Фон | — | — | Центрировать камеру |
| Двойной клик | Узел с Grafana URL | — | — | Открыть Grafana |
| Двойной клик | Свёрнутый namespace | — | — | Развернуть namespace |
| Escape | — | — | — | Закрыть панели, снять выделение |

## Выделение

### Ctrl+Клик (переключение выделения)

Удерживайте **Ctrl** и кликните на узел, чтобы добавить его в выделение или убрать, если уже выделен. Выделенное состояние обозначается синей обводкой и полупрозрачной подсветкой.

Можно одновременно выделить несколько узлов. Клик на узле без Ctrl открывает боковую панель.

### Прямоугольное выделение (Ctrl+Drag на фоне)

Удерживайте **Ctrl** и потяните на пустом фоне, чтобы нарисовать прямоугольник выделения. Все узлы (кроме родительских), центр которых попадает в прямоугольник, будут выделены.

- Прямоугольник появляется после минимального смещения в 5px
- Прямоугольник — полупрозрачный синий оверлей
- Отпускание кнопки мыши завершает выделение
- Прямоугольное выделение работает только при начале перетаскивания на фоне, не на узле

### Сброс выделения

- **Клик на фоне** (без Ctrl): снимает все выделения и закрывает боковую панель
- **Клавиша Escape**: снимает выделение и закрывает все панели (боковая панель, поиск, контекстное меню)

## Режимы перетаскивания

### Перемещение одного узла

Кликните и потяните любой узел для его перемещения. Это стандартное поведение Cytoscape.

### Групповое перетаскивание

Если выделено несколько узлов (через Ctrl+Click или прямоугольное выделение), перетаскивание любого **выделенного** узла перемещает всю группу с сохранением относительных позиций.

Перетаскивание узла, **не входящего** в выделение, перемещает только этот узел.

### Ctrl+Drag: 1 уровень downstream

Удерживайте **Ctrl** и перетащите узел, чтобы переместить его вместе с **прямыми downstream-зависимостями** (1 уровень исходящих рёбер).

Можно комбинировать с групповым выделением — если перетаскиваемый узел входит в выделенную группу, перемещаются и группа, и downstream-узлы.

### Ctrl+Shift+Drag: полный downstream-подграф

Удерживайте **Ctrl+Shift** и перетащите узел, чтобы переместить его вместе со **всем downstream-подграфом** (все транзитивные исходящие зависимости через обход BFS).

Общие зависимости (узлы, на которые ссылаются несколько родителей) включаются, если они попадают в обход downstream.

## Управление камерой

### Панорамирование

Кликните и потяните на пустом фоне, чтобы панорамировать камеру.

### Масштабирование

Используйте колёсико мыши для приближения/отдаления.

### Двойной клик для центрирования

Двойной клик на пустом фоне плавно анимирует камеру так, чтобы точка клика оказалась в центре вьюпорта. Длительность анимации: 300мс.

Двойной клик на **узле** запускает действия для конкретного узла (открытие Grafana или разворачивание namespace) вместо центрирования.

## Граничные случаи

### Свёрнутые namespace

Свёрнутые namespace-узлы (составные родители) ведут себя как обычные узлы при выделении — их можно выделять/снимать через Ctrl+Click. При перетаскивании свёрнутого namespace Cytoscape автоматически перемещает все дочерние узлы.

### Составные узлы

Родительские узлы (namespace) исключаются из проверки попадания при прямоугольном выделении. Только конечные (не родительские) узлы выделяются через прямоугольное выделение и используются для определения фона.

### Временные позиции

Все изменения позиций от перетаскивания являются **временными** — они сбрасываются при:
- Обновлении данных с сервера
- Пересчёте раскладки (кнопка layout или смена типа)
- Перезагрузке страницы (F5)

### Горячие клавиши

См. также панель горячих клавиш (доступна через кнопку `?` на панели инструментов) для полного списка сочетаний.
